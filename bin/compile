#!/bin/bash
set -e

##############################################################################################
# options
##############################################################################################
 
mvnUrl=http://apache.osuosl.org/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.tar.gz
jdkUrl=http://download.java.net/jdk7u60/archive/b15/binaries/jdk-7u60-ea-bin-b15-linux-x64-16_apr_2014.tar.gz?q=download/jdk7u60/archive/b15/binaries/jdk-7u60-ea-bin-b15-linux-x64-16_apr_2014.tar.gz

##############################################################################################
# basic setup
##############################################################################################

echo "==== compile script starting ===="
appDir=$1
cacheDir=$2
echo "appDir = " $appDir
echo "cacheDir = " $cacheDir


rm -fr $cacheDir
mkdir $cacheDir

##############################################################################################
# JDK setup
##############################################################################################
echo ===== setting up JDK =====
cd $cacheDir
wget $jdkUrl -O jdk.tar.gz
mkdir jdk
cd jdk
echo "Unzipping to " `pwd`
javaDirName=`ls jdk*`
echo "javaDirName = " $javaDirName
tar xzvf ${cacheDir}/jdk.tar.gz

export JAVA_HOME=$cacheDir/$javaDirName

echo "----- JDK setup summary ------"
echo JAVA_HOME=$JAVA_HOME

##############################################################################################
# MVN setup
##############################################################################################
echo ==== setting up mvn =====
cd $cacheDir
wget $mvnUrl -O mvn.tar.gz
mkdir mvn
cd mvn
tar xzvf ${cacheDir}/mvn.tar.gz
mvn=${cacheDir}/mvn/*/bin/mvn

# TODO: do we need put maven local in some place other than default?

echo "----- MVN setup summary ------"
$mvn --version

echo "------------------- jdk contents -----------------------------------------"
cd ${cacheDir}/jdk
find . -print
#cd $cacheDir
#echo "pwd = " `pwd`
#ls -laR
echo "------------------- jdk contents -----------------------------------------"

##############################################################################################
# mvn package
##############################################################################################

echo ==== run: mvn package ==================================================================
cd $appDir
echo "PWD = " `pwd`
$mvn package


echo "This script fails for now"
exit 1
